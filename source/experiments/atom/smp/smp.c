#include <stdbool.h>
#include <stdint.h>


#include <stdio.h>
#include <unistd.h>

// ---- BEGIN of source automatically generated by Atom ----


static uint64_t __global_clock = 0;



static const uint32_t __coverage_len = 1;
static uint32_t __coverage[1] = {0};
static uint32_t __coverage_index = 0;
struct {  /* state */
  struct {  /* smp */
    int64_t __channel_s2r_1;
    bool __channel_s2r_1_ready;
    int64_t __channel_s2r_2;
    bool __channel_s2r_2_ready;
    struct {  /* source */
      bool done;
    } source;
    struct {  /* recv1 */
      bool done;
      int64_t recv1_vote;
    } recv1;
    struct {  /* recv2 */
      bool done;
      int64_t recv2_vote;
    } recv2;
  } smp;
} state =
{  /* state */
  {  /* smp */
    /* __channel_s2r_1 */  0LL,
    /* __channel_s2r_1_ready */ false,
    /* __channel_s2r_2 */  0LL,
    /* __channel_s2r_2_ready */ false,
    {  /* source */
      /* done */  false
    },
    {  /* recv1 */
      /* done */  false,
      /* recv1_vote */  0LL
    },
    {  /* recv2 */
      /* done */  false,
      /* recv2_vote */  0LL
    }
  }
};

/* smp.recv2 */
static void __r2() {
  bool __0 = true;
  int64_t __1 = state.smp.__channel_s2r_2;
  int64_t __2 = state.smp.recv2.recv2_vote;
  bool __3 = state.smp.recv2.done;
  int64_t __4 = state.smp.recv1.recv1_vote;
  bool __5 = state.smp.recv1.done;
  bool __6 = state.smp.source.done;
  if (state.smp.__channel_s2r_2_ready) {
    if (__0) {
      printf("recv2_vote: %i\n", __2);
      printf("recv2_done: %i\n", __3);
      printf("recv1_vote: %i\n", __4);
      printf("recv1_done: %i\n", __5);
      printf("source.done: %i\n", __6);
      __coverage[0] = __coverage[0] | (1 << 2);
    }
  state.smp.recv2.recv2_vote = __1;
  state.smp.recv2.done = __0;
  }
}

/* smp.recv1 */
static void __r1() {
  bool __0 = true;
  int64_t __1 = state.smp.__channel_s2r_1;
  int64_t __2 = state.smp.recv1.recv1_vote;
  bool __3 = state.smp.recv1.done;
  bool __4 = state.smp.source.done;
  if (state.smp.__channel_s2r_1_ready) {
    if (__0) {
      printf("recv1_vote: %i\n", __2);
      printf("recv1_done: %i\n", __3);
      printf("source.done: %i\n", __4);
      __coverage[0] = __coverage[0] | (1 << 1);
    }
  state.smp.recv1.recv1_vote = __1;
  state.smp.recv1.done = __0;
  }
}

/* smp.source */
static void __r0() {
  bool __0 = state.smp.source.done;
  bool __1 = ! __0;
  bool __2 = true;
  int64_t __3 = 1LL;
  int64_t __4 = 2LL;
    if (__1) {
      printf("source.done: %i\n", __0);
      __coverage[0] = __coverage[0] | (1 << 0);
      state.smp.__channel_s2r_1 = __3;
      state.smp.__channel_s2r_1_ready = true;
      state.smp.__channel_s2r_2 = __4;
      state.smp.__channel_s2r_2_ready = true;
    }
  state.smp.source.done = __2;
}


static void __assertion_checks() {
}


void smp()
{

  {
    static uint8_t __scheduling_clock = 0;
    if (__scheduling_clock == 0) {
      __assertion_checks(); __r2();  /* smp.recv2 */
      __scheduling_clock = 4;
    }
    else {
      __scheduling_clock = __scheduling_clock - 1;
    }
  }
  {
    static uint8_t __scheduling_clock = 1;
    if (__scheduling_clock == 0) {
      __assertion_checks(); __r1();  /* smp.recv1 */
      __scheduling_clock = 4;
    }
    else {
      __scheduling_clock = __scheduling_clock - 1;
    }
  }
  {
    static uint8_t __scheduling_clock = 2;
    if (__scheduling_clock == 0) {
      __assertion_checks(); __r0();  /* smp.source */
      __scheduling_clock = 4;
    }
    else {
      __scheduling_clock = __scheduling_clock - 1;
    }
  }

  __global_clock = __global_clock + 1;

}

// ---- END of source automatically generated by Atom ----

int main(int argc, char **argv) {
  while(1) { smp(); usleep(1000); }
}

